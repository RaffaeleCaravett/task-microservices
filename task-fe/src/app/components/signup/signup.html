<div class="row text-start">
  @if (step == 1) {
  <form [formGroup]="signupForm" class="row w-75 m-auto">
    <div class="col-12 text-center"><p class="h2 fw-bold">Create a profile</p></div>
    <div class="col-md-12 py-1 pt-5">
      <h2>Dati generali</h2>
    </div>
    <div class="col-md-6">
      <label for="ragioneSociale" class="py-2 fw-bold"> Ragione sociale*</label>
      <input type="text" formControlName="ragioneSociale" class="form-control" />
      @if(signupForm.controls['ragioneSociale'].touched&&signupForm.controls['ragioneSociale'].invalid){
      <p class="text-danger">Campo obbligatorio</p>
      }
    </div>
    <div class="col-md-6">
      <label for="partitaIva" class="py-2 fw-bold">Partita Iva*</label>
      <input type="text" formControlName="partitaIva" class="form-control" />
      @if(signupForm.controls['partitaIva'].touched&&signupForm.controls['partitaIva'].hasError('required')){
      <p class="text-danger">Campo obbligatorio</p>
      }@else if(signupForm.controls['partitaIva'].touched
      &&signupForm.controls['partitaIva'].hasError('pattern')){
      <p class="text-danger">Inserisci una partita iva valida</p>
      }
    </div>
    <div class="col-md-12">
      <label for="formaGiuridica" class="py-2 fw-bold"> Forma giuridica*</label>
      <select formControlName="formaGiuridica" class="form-select">
        @for (item of forme; track $index) {
        <option value="{{ item.id }}">{{ item.name }}</option>
        }@empty {
        <option value=""></option>
        }
      </select>
      @if(signupForm.controls['formaGiuridica'].touched&&signupForm.controls['formaGiuridica'].invalid){
      <p class="text-danger">Campo obbligatorio</p>
      }
    </div>

    <form formGroupName="indirizzo" class="row p-0 m-0">
      <div class="col-md-12 py-1 pt-5">
        <h2>Indirizzo</h2>
      </div>
      <div class="col-md-12">
        <label for="nazione" class="py-2 fw-bold"> Paese di registrazione*</label>
        <select
          formControlName="nazione"
          class="form-select"
          (change)="
            onChangeNations(signupForm.controls['indirizzo'].get('nazione')?.value, 'indirizzo')
          "
        >
          @for (item of nazioni; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['indirizzo'].get('nazione')?.touched&&signupForm.controls['indirizzo'].get('nazione')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="regione" class="py-2 fw-bold">Regione*</label>
        <select
          formControlName="regione"
          class="form-select"
          (change)="
            onChangeRegions(signupForm.controls['indirizzo'].get('regione')?.value, 'indirizzo')
          "
        >
          @for (item of regioni; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty{
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['indirizzo'].get('regione')?.touched&&signupForm.controls['indirizzo'].get('regione')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="citta" class="py-2 fw-bold">CittÃ *</label>
        <select
          formControlName="citta"
          class="form-select"
          (change)="
            onChangeCitta(signupForm.controls['indirizzo'].get('citta')?.value, 'indirizzo')
          "
        >
          @for (item of citta; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['indirizzo'].get('citta')?.touched&&signupForm.controls['indirizzo'].get('citta')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="cap" class="py-2 fw-bold">Cap*</label>
        <select formControlName="cap" class="form-select">
          @for (item of cap; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['indirizzo'].get('cap')?.touched&&signupForm.controls['indirizzo'].get('cap')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-12">
        <label for="via" class="py-2 fw-bold">Via*</label>
        <input type="text" class="form-control" formControlName="via" />
        @if(signupForm.controls['indirizzo'].get('via')?.touched&&signupForm.controls['indirizzo'].get('via')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
    </form>
    <div class="col-md-8">
      <label for="settore" class="py-2 fw-bold">Settore*</label>
      <select formControlName="settore" class="form-select">
        @for (item of settori; track $index) {
        <option value="{{ item.id }}">{{ item.name }}</option>
        }@empty {
        <option value=""></option>
        }
      </select>
      @if(signupForm.controls['settore'].touched&&signupForm.controls['settore'].invalid){
      <p class="text-danger">Campo obbligatorio</p>
      }
    </div>
    <div class="col-md-4">
      <label for="dimensioniAzienda" class="py-2 fw-bold">Dimensioni*</label>
      <select formControlName="dimensioniAzienda" class="form-select">
        @for (item of dimensioni; track $index) {
        <option value="{{ item.id }}">{{ item.label }}</option>
        }@empty {
        <option value=""></option>
        }
      </select>
      @if(signupForm.controls['dimensioniAzienda'].touched&&signupForm.controls['dimensioniAzienda'].invalid){
      <p class="text-danger">Campo obbligatorio</p>
      }
    </div>
    <div class="col-md-12 py-4">
      <div class="form-check">
        <input
          type="checkbox"
          id="settore"
          formControlName="differentWorkStation"
          class="form-check-input mt-2"
          (change)="updateSedeOperativa()"
        />
        <label for="settore" class="py-2 fw-bold">Sede operativa diversa dalla sede legale</label>
      </div>
    </div>
    @if(signupForm.controls['differentWorkStation'].value){
    <form formGroupName="sedeOperativa" class="row p-0 m-0">
      <div class="col-md-12 pt-5 py-1">
        <h2>Sede operativa</h2>
      </div>
      <div class="col-md-12">
        <label for="nazione" class="py-2 fw-bold"> Paese di registrazione*</label>
        <select
          formControlName="nazione"
          class="form-select"
          (change)="
            onChangeNations(signupForm.controls['sedeOperativa'].get('nazione')?.value, 'sede')
          "
        >
          @for (item of nazioniSede; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['sedeOperativa'].get('nazione')?.touched&&signupForm.controls['sedeOperativa'].get('nazione')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="regione" class="py-2 fw-bold">Regione*</label>
        <select
          formControlName="regione"
          class="form-select"
          (change)="
            onChangeRegions(signupForm.controls['sedeOperativa'].get('regione')?.value, 'sede')
          "
        >
          @for (item of regioniSede; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['sedeOperativa'].get('regione')?.touched&&signupForm.controls['sedeOperativa'].get('regione')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="citta" class="py-2 fw-bold">CittÃ *</label>
        <select
          formControlName="citta"
          class="form-select"
          (change)="onChangeCitta(signupForm.controls['sedeOperativa'].get('citta')?.value, 'sede')"
        >
          @for (item of cittaSede; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['sedeOperativa'].get('citta')?.touched&&signupForm.controls['sedeOperativa'].get('citta')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-md-4">
        <label for="cap" class="py-2 fw-bold">Cap*</label>
        <select formControlName="cap" class="form-select">
          @for (item of capSede; track $index) {
          <option value="{{ item.id }}">{{ item.name }}</option>
          }@empty {
          <option value=""></option>
          }
        </select>
        @if(signupForm.controls['sedeOperativa'].get('cap')?.touched&&signupForm.controls['sedeOperativa'].get('cap')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
      <div class="col-12">
        <label for="via" class="py-2 fw-bold">Via*</label>
        <input type="text" class="form-control" formControlName="via" />
        @if(signupForm.controls['sedeOperativa'].get('via')?.touched&&signupForm.controls['sedeOperativa'].get('via')?.invalid){
        <p class="text-danger">Campo obbligatorio</p>
        }
      </div>
    </form>
    }
    <div class="col-md-12">
      <label for="email" class="py-2 fw-bold">Email*</label>
      <input formControlName="email" type="email" class="form-control" />
      @if(signupForm.controls['email'].touched&&signupForm.controls['email'].hasError('pattern')){
      <p class="text-danger">Inserisci una email valida</p>
      }@else if(signupForm.controls['email'].touched&&
      signupForm.controls['email'].hasError('required')){
      <p class="text-danger">Campo obbligatorio</p>
      }
    </div>
    <div class="col-md-6">
      <label for="password" class="py-2 fw-bold">Password*</label>
      <input formControlName="password" class="form-control" type="password" />
      @if(signupForm.controls['password'].touched&&signupForm.controls['password'].hasError('pattern')){
      <p class="text-danger">
        Inserisci una password valida (1 maiuscola, 1 simobolo fra @$!%*?&, 1 numero, 1 minuscola e
        minimo 8 caratteri)
      </p>
      }@else if(signupForm.controls['password'].touched&&
      signupForm.controls['password'].hasError('required')){
      <p class="text-danger">Campo obbligatorio</p>
      }@else if(signupForm.controls['password'].valid&&
      signupForm.controls['password'].value==signupForm.controls['ripetiPassword'].value){
      <p class="text-success">Le password combaciano</p>
      }
    </div>
    <div class="col-md-6">
      <label for="password" class="py-2 fw-bold">Ripeti password*</label>
      <input formControlName="ripetiPassword" class="form-control" type="password" />
      @if(signupForm.controls['ripetiPassword'].touched&&signupForm.controls['ripetiPassword'].hasError('pattern')){
      <p class="text-danger">
        Inserisci una password valida (1 maiuscola, 1 simobolo fra @$!%*?&, 1 numero, 1 minuscola e
        minimo 8 caratteri)
      </p>
      }@else if(signupForm.controls['ripetiPassword'].touched&&
      signupForm.controls['ripetiPassword'].hasError('required')){
      <p class="text-danger">Campo obbligatorio</p>
      }@else if(signupForm.controls['password'].valid&&
      signupForm.controls['password'].value!=signupForm.controls['ripetiPassword'].value){
      <p class="text-danger">La password non combacia</p>
      }@else if(signupForm.controls['password'].valid&&
      signupForm.controls['password'].value==signupForm.controls['ripetiPassword'].value){
      <p class="text-success">Le password combaciano</p>
      }
    </div>
  </form>
  }@else if(step == 2){ @for (item of piani; track $index) {
  <div
    class="card w-75 m-auto my-2 shadow-sm"
    [ngClass]="item == choosedPlan ? 'choosed-border' : ''"
  >
    <div
      class="card-header fw-bolder"
      [ngClass]="
        item.titolo == 'FREE PLAN'
          ? 'text-success'
          : item.titolo == 'MEDIUM PLAN'
          ? 'text-info'
          : item.titolo == 'GOLDEN PLAN'
          ? 'text-warning'
          : 'text-danger'
      "
    >
      {{ item.titolo }}
      {{
        item.titolo == 'FREE PLAN'
          ? 'ðŸ’¸'
          : item.titolo == 'MEDIUM PLAN'
          ? 'ðŸŒŠ'
          : item.titolo == 'GOLDEN PLAN'
          ? 'ðŸª™'
          : 'ðŸ”¥'
      }}
    </div>
    <div class="card-body">
      <h5 class="card-title">{{ item.prezzo | currency : 'EUR' }}</h5>
      <p class="card-text">
        {{ item.description }}
      </p>
      <button
        (click)="choosedPlan = item"
        class="btn"
        [ngClass]="
          item.titolo == 'FREE PLAN'
            ? 'btn-success'
            : item.titolo == 'MEDIUM PLAN'
            ? 'btn-info'
            : item.titolo == 'GOLDEN PLAN'
            ? 'btn-warning'
            : 'btn-danger'
        "
      >
        Choose plan
      </button>
    </div>
  </div>
  } }

  <div class="w-75 m-auto text-center py-4">
    @if (step>1) {
    <button class="btn btn-light m-1" (click)="step -=1" pTooltip="Back" tooltipPosition="left">
      Indietro
    </button>
    } @if(step == 1){
    <button
      class="btn btn-primary m-1"
      (click)="step +=1"
      [disabled]="signupForm.invalid || passwordMismatch()"
      pTooltip="Forward"
    >
      Avanti
    </button>
    }@else if(step==2){
    <button
      class="btn btn-primary m-1"
      (click)="step +=1"
      [disabled]="!choosedPlan"
      pTooltip="Forward"
    >
      Avanti
    </button>
    } @if(step ==3){
    <button
      class="btn btn-primary m-1"
      (click)="signup()"
      [disabled]="signupForm.invalid || passwordMismatch() || !choosedPlan"
      pTooltip="Register"
    >
      Signup
    </button>
    }
    <hr />
    <p>or</p>
  </div>
  <div class="w-75 m-auto py-4 text-center">
    <button class="btn btn-outline-warning" (click)="goToLogin()" pTooltip="Go to signin">
      Login
    </button>
  </div>
</div>
